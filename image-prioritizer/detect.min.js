const consoleLogPrefix="[Image Prioritizer]",externalBackgroundImages=[];function log(...e){console.log(consoleLogPrefix,...e)}export async function initialize({isDebug:e,onLCP:n}){n((n=>{handleLCPMetric(n,e)}),{reportAllChanges:!0})}function handleLCPMetric(e,n){for(const t of e.entries){if(!t.url||!(t.element instanceof HTMLElement)||t.element instanceof HTMLImageElement||t.element instanceof HTMLVideoElement)continue;if(t.url.startsWith("data:"))continue;if(t.element.style.backgroundImage)continue;if(t.url.length>500)return void(n&&log(`Skipping very long URL: ${t.url}`));if(t.element.tagName.length>100)return void(n&&log(`Skipping very long tag name: ${t.element.tagName}`));const e=t.element.getAttribute("id");if("string"==typeof e&&e.length>100)return void(n&&log(`Skipping very long ID: ${e}`));const o=t.element.getAttribute("class");if("string"==typeof o&&o.length>500)return void(n&&log(`Skipping very long className: ${o}`));const l={url:t.url,tag:t.element.tagName,id:e,class:o};n&&log("Detected external LCP background image:",l),externalBackgroundImages.push(l)}}export async function finalize({extendRootData:e,isDebug:n}){if(0===externalBackgroundImages.length)return;const t=externalBackgroundImages.pop();n&&log("Sending external background image for LCP element:",t),e({lcpElementExternalBackgroundImage:t})}